// link.js
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyArUMHWhrM-g0m0-kXTu_EWmGACetQvLlc",
  authDomain: "asf-panel-sm.firebaseapp.com",
  projectId: "asf-panel-sm",
  storageBucket: "asf-panel-sm.firebasestorage.app",
  messagingSenderId: "444535178333",
  appId: "1:444535178333:web:da733a6f819a0c4529f9b4",
  measurementId: "G-BSFWL4LLY5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const linkNameInput = document.getElementById("linkName");
const linkURLInput = document.getElementById("linkURL");
const addBtn = document.getElementById("addBtn");
const linkTableBody = document.querySelector("#linkTable tbody");

// Add new link
addBtn.addEventListener("click", () => {
  const name = linkNameInput.value.trim();
  const url = linkURLInput.value.trim();
  if(!name || !url){
    alert("Please enter both Link Name and URL");
    return;
  }
  const linkId = Date.now(); // simple unique ID
  set(ref(db, `websiteLinks/${linkId}`), { name, url })
    .then(() => {
      linkNameInput.value = "";
      linkURLInput.value = "";
    })
    .catch(err => alert("Error: " + err.message));
});

// Load links
onValue(ref(db, "websiteLinks"), (snapshot) => {
  const data = snapshot.val();
  linkTableBody.innerHTML = "";
  if(!data) return;

  Object.keys(data).forEach(key => {
    const link = data[key];
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${link.name}</td>
      <td><a href="${link.url}" target="_blank">${link.url}</a></td>
      <td><button class="deleteBtn">Delete</button></td>
    `;

    // Delete with confirmation
    row.querySelector(".deleteBtn").addEventListener("click", () => {
      if(confirm(`Are you sure you want to delete "${link.name}"?`)){
        remove(ref(db, `websiteLinks/${key}`))
          .catch(err => alert("Error: " + err.message));
      }
    });

    linkTableBody.appendChild(row);
  });
});
